---
title: "Censorship-on-Social-Media-1"
author: "Asmer Asrar Safi"
date: "4/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(fivethirtyeight)
library(tidyverse)
library(dplyr)
library(readr)
library(patchwork)
library(purrr)
library(stringr)
library(ggthemes)
library(tibble)
library(gganimate)
library(janitor)
library(skimr)
library(gt)
library(forcats)
library(broom)
library(plyr)
```


```{r, load the data, include=FALSE, message=FALSE}


# LOADING the relevant removal requests data 
mydata <- ldply(list.files(path="~/Documents/Gov 1005/Censorship-On-Social-Media/Raw-Data/Removal Requests//",pattern="csv",full.names=TRUE),function(filename) {
    dum=read_csv(filename, locale = locale(encoding = "latin1"))
    dum$filename=filename
    return(dum)
})
mydata <- mydata %>% 
  clean_names() 

view(mydata)


```


```{r, wrangling, echo=FALSE}
# filtering for the relevant countries

wrangledata <- mydata %>% 
  filter(country %in% c("Pakistan", "India", "Turkey", "Israel", "United States", "Russia"))


wrangledata$accounts_specified <- as.numeric(wrangledata$accounts_specified)

wrangledata$time_period <- as.factor(wrangledata$time_period)

wrangledata$time_period <- factor(wrangledata$time_period, levels =
           c("January - June 2012",
             "July - December 2012",
             "January - June 2013",
             "July - December 2013",
             "January - June 2014",
             "July - December 2014",
             "January - June 2015",
             "July - December 2015",
             "January - June 2016",
             "July - December 2016",
             "January - June 2017",
             "July - December 2017",
             "January - June 2018",
             "July - December 2018",
             "January - June 2019"))

wrangledata <- 
  wrangledata %>% 
  mutate(accounts_specified = replace_na(accounts_specified, 0)) 
wrangledata

```




```{r}

Plot1 <- wrangledata %>% 
select(country,
       accounts_specified,
       time_period) %>% 
ggplot(aes(x = time_period,
           y = accounts_specified, 
           color = country)) + 
  geom_point() +
  scale_color_stata() +
  theme_few() +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1,
                                   size = 6),
        axis.text.y = element_text(size = 6)) +
  labs(x = "Time Period", 
       y = "Accounts Specified",
       color = "Country", 
       title = "Accounts Specified for Content Withdrawal
from January 2012 to June 2019",
subtitle = "Data from Twitter Transparency Reports") +
 transition_states(
    time_period,
    transition_length = 2,
    state_length = 1
  ) +
  shadow_mark() +
  enter_fade() + 
  exit_shrink() +
  ease_aes('sine-in-out')

Plot1
```


```{r}

Plot2 <- wrangledata %>% 
select(country,
       accounts_specified,
       time_period) %>% 
ggplot(aes(x = time_period,
           y = accounts_specified, 
           color = country)) + 
  geom_point() +
  scale_color_stata() +
  theme_few() +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1,
                                   size = 6),
        axis.text.y = element_text(size = 6)) +
  labs(x = "Time Period", 
       y = "Accounts Specified",
       color = "Country", 
       title = "Accounts Specified for Content Withdrawal
from January 2012 to June 2019",
subtitle = "Data from Twitter Transparency Reports") +
 facet_wrap(~country) +
 transition_states(
    time_period,
    transition_length = 2,
    state_length = 1
  ) +
  shadow_mark() +
  enter_fade() + 
  exit_shrink() +
  ease_aes('sine-in-out')

Plot2

```


```{r}

wrangledata$percentage_where_some_content_withheld = as.numeric(gsub("[\\%,]", "", wrangledata$percentage_where_some_content_withheld))

wrangledata <- 
  wrangledata %>% 
  mutate(percentage_where_some_content_withheld = replace_na(percentage_where_some_content_withheld, 0)) 

Plot3 <- wrangledata %>% 
  ggplot(aes(time_period, 
             percentage_where_some_content_withheld,
             color = country)) +
  geom_point() + 
  theme_few() + 
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1,
                                   size = 6),
        axis.text.y = element_text(size = 6)) +
  labs(x = "Time Period", 
       y = "Percentage of Requests Complied with",
       color = "Country", 
       title = "Percentage of Requests Complied with by Twitter
January 2012 - June 2019",
subtitle = "Data from Twitter Transparency Reports") +
  scale_color_stata()

Plot3
```


```{r, total tweet requests}

# Retrieving total - create function for columns. 


mydata$accounts_specified <- as.numeric(mydata$accounts_specified)

mydata$time_period <- as.factor(mydata$time_period)

mydata$time_period <- factor(mydata$time_period, levels =
           c("January - June 2012",
             "July - December 2012",
             "January - June 2013",
             "July - December 2013",
             "January - June 2014",
             "July - December 2014",
             "January - June 2015",
             "July - December 2015",
             "January - June 2016",
             "July - December 2016",
             "January - June 2017",
             "July - December 2017",
             "January - June 2018",
             "July - December 2018",
             "January - June 2019"))

mydata <- 
  mydata %>% 
  mutate(accounts_specified = replace_na(accounts_specified, 0)) 


get_total <- function(x){
 wrangledata %>% 
  filter(time_period == x) %>% 
  summarize(total = sum(accounts_specified)) %>% 
  pull(total)
}

get_total("January - June 2014")


total_accounts_specified <- 
  tibble(time_period = c("January - June 2012",
             "July - December 2012",
             "January - June 2013",
             "July - December 2013",
             "January - June 2014",
             "July - December 2014",
             "January - June 2015",
             "July - December 2015",
             "January - June 2016",
             "July - December 2016",
             "January - June 2017",
             "July - December 2017",
             "January - June 2018",
             "July - December 2018",
             "January - June 2019"))

total_accounts_specified$time_period <- factor(total_accounts_specified$time_period, levels =
           c("January - June 2012",
             "July - December 2012",
             "January - June 2013",
             "July - December 2013",
             "January - June 2014",
             "July - December 2014",
             "January - June 2015",
             "July - December 2015",
             "January - June 2016",
             "July - December 2016",
             "January - June 2017",
             "July - December 2017",
             "January - June 2018",
             "July - December 2018",
             "January - June 2019"))


total_accounts_specified$time_period <- as.factor(total_accounts_specified$time_period)

total_accounts_specified <- total_accounts_specified %>% 
  mutate(total_accounts = map_dbl(time_period, get_total))

Plot4 <- total_accounts_specified %>% 
  ggplot(aes(time_period, total_accounts)) + 
  scale_color_solarized() +
  geom_line(aes(group = 1, color = "darkblue")) +
  geom_point(color = "darkblue") +
  theme_few() +
   labs(x = "Time Period", 
       y = "Total Number of Accounts Specified in Given Time Period",
       color = "Country", 
       title = "Total Number of Accounts Specified
January 2012 - June 2019",
caption = "Data from Twitter Transparency Reports") + 
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1,
                                   size = 7),
        axis.text.y = element_text(size = 7),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 8)) + 
  theme(legend.position = "none") + 
  transition_reveal(as.numeric(time_period))

Plot4
```

